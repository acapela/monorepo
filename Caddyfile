:3000

handle_path /graphql {
	rewrite * /v1/graphql
	reverse_proxy {$HASURA_HOST}
}

handle_path /api/backend/* {
	rewrite * /api{path}
	reverse_proxy {$BACKEND_HOST}
}

handle_path /api/backend/healthz {
	rewrite * /healthz
	reverse_proxy {$BACKEND_HOST}
}

handle_path /attachments/* {
	rewrite * /attachments{path}
	reverse_proxy {$BACKEND_HOST}
}

handle /sentry-tunnel {
	reverse_proxy {$BACKEND_HOST}
}

handle_path /healthz {
	rewrite * /api/healthz
	reverse_proxy {$FRONTEND_HOST}
}

@legacyTopic path_regexp topic ^\/(.*)\/topic\/(.*)\/(.*)$
redir @legacyTopic /{re.topic.1}/{re.topic.2}/{re.topic.3}

reverse_proxy {$FRONTEND_HOST}

log {
	level ERROR
}
